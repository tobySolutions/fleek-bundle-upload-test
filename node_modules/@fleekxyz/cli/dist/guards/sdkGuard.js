"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sdkGuard = exports.getSdkClient = void 0;
const errors_1 = require("@fleekxyz/errors");
const sdk_1 = require("@fleekxyz/sdk");
const cli_1 = require("../cli");
const config_1 = require("../config");
const loginGuard_1 = require("./loginGuard");
const getSdkClient = () => {
    const personalAccessToken = config_1.config.personalAccessToken.get();
    const projectId = config_1.config.projectId.get();
    if (!personalAccessToken) {
        return;
    }
    const accessTokenService = new sdk_1.PersonalAccessTokenService({ projectId, personalAccessToken });
    const sdk = new sdk_1.FleekSdk({ accessTokenService });
    return sdk;
};
exports.getSdkClient = getSdkClient;
const sdkGuard = (func) => {
    return async (args = {}) => {
        await (0, loginGuard_1.loginGuard)();
        const sdk = (0, exports.getSdkClient)();
        if (!sdk) {
            throw new errors_1.UnauthenticatedError();
        }
        try {
            await func({ sdk, args });
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
        }
        catch (error) {
            cli_1.output.error(error?.toString());
        }
    };
};
exports.sdkGuard = sdkGuard;
//# sourceMappingURL=sdkGuard.js.map