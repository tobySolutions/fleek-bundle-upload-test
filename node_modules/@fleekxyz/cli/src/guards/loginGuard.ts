import { output } from '../cli';
import { createLoginActionHandler } from '../commands/auth/login';
import { config } from '../config';
import { getDefined } from '../defined';
import { t } from '../utils/translation';

export const loginGuard = async () => {
  const accessToken = config.personalAccessToken.get();

  if (accessToken) {
    return;
  }

  output.warn(t('authReqStartLogginFlow'));
  output.printNewLine();

  const loginActionHandler = createLoginActionHandler({
    uiAppUrl: getDefined('UI__APP_URL'),
    authApiUrl: getDefined('SDK__GRAPHQL_API_URL'),
  });

  await loginActionHandler();
};
